# Google Drive 翻訳ツール

## 概要

このGoogle Apps Script（GAS）プロジェクトは、Google Drive上のファイル（スプレッドシート、ドキュメント、プレゼンテーション）を、OpenAIのLLM（`gpt-4o-mini`）を活用して翻訳するためのWebアプリケーションです。

ユーザーフレンドリーなUIを備え、専門用語の翻訳精度を向上させるための辞書機能や、過去の翻訳履歴を確認できる機能を提供します。

## 主な機能

- **多形式ファイル対応**: Google スプレッドシート、ドキュメント、プレゼンテーションの翻訳に対応。
- **高品質な翻訳**: OpenAIの最新モデルを利用し、自然で正確な翻訳を実現。
- **カスタム辞書機能**:
    - ユーザーが独自の辞書を作成・管理可能。
    - 辞書に登録した用語は翻訳時に優先的に適用され、専門分野の翻訳精度が向上。
    - 辞書のインポート/エクスポート機能（JSON形式）。
- **翻訳履歴管理**:
    - 過去の翻訳ジョブを自動で記録。
    - 翻訳元/先のファイル、言語、文字数、処理時間などを一覧で確認可能。
- **統計ダッシュボード**:
    - 翻訳回数、総文字数、推定APIコストなどを可視化。
    - 利用状況を分析し、コスト管理に役立てることが可能。
- **直感的なWeb UI**:
    - ファイルURLを入力し、言語と辞書を選択するだけの簡単操作。
    - 翻訳、履歴、辞書管理、統計の各機能がタブで整理されたインターフェース。

## 設計思想

このツールは、以下の思想に基づいて設計されています。

1.  **拡張性と保守性**:
    - 各機能をクラス（`FileHandler`, `Translator`, `Dictionary`, `History`）に分割し、関心事を分離。
    - 設定値は`Config.gs`に集約し、変更を容易に。
    - 新しいファイル形式や翻訳エンジンへの対応も、関連クラスの修正で実現可能。

2.  **ユーザー中心設計**:
    - コーディング知識がなくても使える直感的なWeb UIを提供。
    - 翻訳プロセスを可視化し、結果をすぐに確認できるフィードバックループ。
    - 辞書機能により、ユーザー自身が翻訳品質をカスタマイズできる。

3.  **堅牢性と信頼性**:
    - APIエラーやファイルアクセスエラーに対する詳細なエラーハンドリングを実装。
    - 翻訳ジョブの成功・失敗を問わず履歴に記録し、問題追跡を容易に。
    - APIのレートリミットや文字数制限を考慮したバッチ処理とリトライ機構。

4.  **パフォーマンス**:
    - 辞書データをキャッシュし、スプレッドシートへのアクセスを最小化。
    - 複数のテキストをまとめて翻訳するバッチ処理により、APIコール回数を削減。

## プロジェクト構成

```
/
├── Code.gs             # メインロジック、サーバーサイド関数のエントリーポイント
├── Config.gs           # APIキー、モデル名、スプレッドシートIDなどの設定ファイル
├── Dictionary.gs       # 辞書機能（作成、検索、インポート/エクスポート）を管理するクラス
├── FileHandler.gs      # Google Driveファイルの読み書き、コンテンツ抽出を管理するクラス
├── History.gs          # 翻訳履歴の記録と取得を管理するクラス
├── Translator.gs       # OpenAI APIとの連携、翻訳処理の実行を管理するクラス
└── UI.html             # フロントエンドのHTML、CSS、JavaScript
```

### 各ファイルの役割

- **`Code.gs`**:
    - Webアプリの`doGet`関数を定義し、UIを表示するエントリーポイント。
    - `UI.html`から呼び出されるサーバーサイド関数（`translateFile`, `getDictionaryList`など）の窓口。
- **`Config.gs`**:
    - スクリプトプロパティからAPIキーなどの機密情報を取得。
    - アプリケーション全体で使用する定数（対応言語、ファイル形式、エラーメッセージなど）を定義。
    - 初回実行時に履歴と辞書用のスプレッドシートを自動作成するロジックを含む。
- **`FileHandler.gs`**:
    - 指定されたファイルIDに基づき、ファイル形式（Spreadsheet, Document, Presentation）を判別。
    - 各ファイル形式に応じた方法でテキストコンテンツとスタイル情報を抽出。
    - 翻訳後のコンテンツから新しいGoogle Driveファイルを作成。
- **`Translator.gs`**:
    - 抽出されたテキストを、APIの文字数制限に合わせてチャンクに分割。
    - 辞書データをプロンプトに含め、OpenAI APIにリクエストを送信。
    - APIからの応答（翻訳済みテキスト）を元のファイル構造に再構築。
- **`Dictionary.gs`**:
    - 辞書データが格納されたGoogleスプレッドシートを操作。
    - 辞書のCRUD（作成、読み取り、更新、削除）機能を提供。
    - パフォーマンス向上のため、辞書データを一時的にキャッシュ。
- **`History.gs`**:
    - 翻訳ジョブの詳細（日時、ファイル情報、結果、エラーなど）をGoogleスプレッドシートに記録。
    - UIに表示するための履歴データを取得。
    - 日次での利用統計をサマリーシートに記録。
- **`UI.html`**:
    - HTML、CSS、JavaScriptで構成されたシングルページのWebアプリケーション。
    - `google.script.run`を使用してサーバーサイドのGAS関数を非同期に呼び出す。
    - 翻訳の進捗表示、結果のフィードバック、各種データの表示など、動的なUIを構築。

## セットアップとデプロイ

### 1. スクリプトプロパティの設定

1.  GASエディタの左メニューから「プロジェクトの設定」（歯車アイコン）を開く。
2.  「スクリプト プロパティ」セクションで、以下のキーと値を設定します。
    - `OPENAI_API_KEY`: あなたのOpenAI APIキー
    - `OPENAI_ORGANIZATION_ID`: あなたのOpenAI Organization ID
    - `OPENAI_PROJECT_ID`: あなたのOpenAI Project ID

### 2. 初回セットアップ

1.  GASエディタで`Code.gs`を開き、関数一覧から`setupApplication`を選択して実行します。
2.  承認プロンプトが表示されたら、必要な権限を許可します。
3.  これにより、APIの利用に必要な権限が付与され、履歴と辞書用のスプレッドシートが自動で作成されます。

### 3. デプロイ

1.  GASエディタ右上の「デプロイ」ボタンをクリックし、「新しいデプロイ」を選択。
2.  種類の選択で「ウェブアプリ」を選択。
3.  以下の設定でデプロイします。
    - **説明**: （任意）
    - **ウェブアプリを実行するユーザー**: 自分
    - **アクセスできるユーザー**: （セキュリティ要件に合わせて選択。例: `Googleアカウントを持つ全員`）
4.  「デプロイ」をクリックすると、ウェブアプリのURLが生成されます。このURLにアクセスするとツールを利用できます。

## 今後の展望

- 非同期処理への対応（長時間かかる大規模ファイルの翻訳）
- 対応ファイル形式の追加（PDF、テキストファイルなど）
- 辞書機能の強化（正規表現対応、用語の自動抽出提案など）
- 他のLLM（Gemini, Claudeなど）への対応
